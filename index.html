<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>韓語學習小站 v6.3 — 全功能</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#ff6680" />
  <style>
    :root { --pink:#ff6680; --sub:#ffe6eb; --bg:#fdfdfd; }
    body { font-family: "Microsoft JhengHei", system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans CJK TC", sans-serif; margin:0; background:var(--bg); color:#222; }
    header { background:var(--pink); color:#fff; padding:16px; text-align:center; }
    nav { position:sticky; top:0; background:var(--sub); padding:10px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; z-index:10; }
    nav a { padding:8px 12px; font-weight:700; text-decoration:none; color:#333; background:#fff; border-radius:20px; border:1px solid #f1c2cc; }
    section { padding:16px; max-width:1100px; margin:0 auto; }
    h2 { color:var(--pink); margin:8px 0 12px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(64px,1fr)); gap:10px; }
    .card { background:#fff; border:1px solid #f2d5dc; border-radius:10px; padding:10px; text-align:center; cursor:pointer; }
    .k{ font-size:26px; font-weight:900; }
    .small { font-size:12px; color:#666; margin-top:6px; }
    .box { background:#fff; border:1px solid #f2d5dc; border-radius:12px; padding:12px; margin:10px 0; }
    .row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .chip { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid #e8b9c4; margin:4px; cursor:pointer; background:#fff; }
    .chip.active { background:var(--pink); color:#fff; border-color:var(--pink); }
    .btn { border:0; background:var(--pink); color:#fff; padding:8px 12px; border-radius:8px; font-weight:700; cursor:pointer; }
    .btn.outline { background:#fff; color:var(--pink); border:2px solid var(--pink); }
    .btn.ghost { background:#fff; color:#333; border:1px solid #ddd; }
    .search { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e8b9c4; }
    .dialogue { display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; border-bottom:1px dashed #f0c5cf; padding:10px 0; }
    .ko { font-weight:800; font-size:18px; }
    .zh { color:#444; font-size:14px; }
    .right { display:flex; gap:8px; align-items:center; }
    .fav { font-size:20px; cursor:pointer; }
    .numgrid { display:grid; grid-template-columns:repeat(auto-fill,minmax(90px,1fr)); gap:10px; }
    .numcard { background:#fff; border:1px solid #e7d6db; border-radius:10px; padding:10px; text-align:center; cursor:pointer; }
    footer { text-align:center; padding:14px; background:var(--pink); color:#fff; margin-top:20px; }
  </style>
</head>
<body>
  <header>
    <h1>韓語學習小站 v6.3</h1>
    <p>40音・200組對話（主題專屬回覆）・數字/量詞・標籤/收藏・自訂中文→韓文・測驗遊戲・記住語音</p>
  </header>

  <nav>
    <a href="#voice">語音設定</a>
    <a href="#alphabet">40 音</a>
    <a href="#numbers">數字/量詞</a>
    <a href="#dialogues">200 組對話</a>
    <a href="#custom">自訂中文→韓文</a>
    <a href="#quiz">測驗遊戲</a>
  </nav>

  <section id="voice" class="box">
    <h2>語音設定（記住你的選擇）</h2>
    <div class="row">
      <label>選擇語音：</label><select id="voiceSelect"></select>
      <label>速度</label><input id="rate" type="range" min="0.6" max="1.4" step="0.05" value="1">
      <label>音調</label><input id="pitch" type="range" min="0.6" max="1.4" step="0.05" value="1">
      <button class="btn" id="testBtn">▶ 測試：안녕하세요</button>
      <div class="small">若清單沒有韓文語音，請到系統下載韓文語音包。</div>
    </div>
  </section>

  <section id="alphabet">
    <h2>韓文 40 音</h2>
    <details open class="box">
      <summary>母音（21）</summary>
      <div id="vowels" class="grid"></div>
    </details>
    <details open class="box">
      <summary>子音（19）</summary>
      <div id="consonants" class="grid"></div>
    </details>
  </section>

  <section id="numbers" class="box">
    <h2>數字＋量詞練習</h2>
    <div class="row">
      <label>數字（1~10）：</label><input id="qtyNum" type="number" min="1" max="10" value="1" style="width:80px;">
      <label>量詞：</label><select id="qtyCounter"></select>
      <button class="btn" id="qtySpeak">▶ 朗讀</button>
      <div id="qtyOut" class="small"></div>
    </div>
    <h3>常用數詞卡</h3>
    <div id="numGrid" class="numgrid"></div>
  </section>

  <section id="dialogues">
    <h2>日常對話（200 組，主題專屬回覆）</h2>
    <div class="box">
      <div class="row">
        <input id="q" class="search" placeholder="搜尋主題/韓文/中文（例：飾品／가격／지하철）" />
        <button class="btn outline" onclick="resetFilter()">清除搜尋</button>
        <button class="btn ghost" id="showFav">只看收藏</button>
      </div>
      <div id="tagBar" style="margin-top:8px;"></div>
    </div>
    <div id="dialogueList"></div>
  </section>

  <section id="custom" class="box">
    <h2>自訂中文 → 韓文（發音練習）</h2>
    <div class="row">
      <input id="cnInput" class="search" placeholder="輸入中文句子（例：請給我一杯水）" style="flex:1;">
      <button class="btn" id="cnSuggest">產生建議韓文</button>
    </div>
    <div class="row" style="margin-top:8px;">
      <input id="koInput" class="search" placeholder="韓文結果（可自行修改）" style="flex:1;">
      <button class="btn" id="koSpeak">▶ 朗讀韓文</button>
      <button class="btn outline" id="saveCustom">加入到『我的對話』</button>
    </div>
    <div class="small">說明：此處的中文→韓文為簡易字典建議，請自行修正為最自然的表達。</div>
    <div id="myList" style="margin-top:10px;"></div>
  </section>

  <section id="quiz" class="box">
    <h2>測驗遊戲：配對韓文與中文</h2>
    <div class="row">
      <button class="btn" id="startQuiz">開始測驗</button>
      <div id="quizScore" class="small"></div>
    </div>
    <div id="quizArea" style="margin-top:10px;"></div>
  </section>

  <footer>© 2025 韓語學習小站 — v6.3（PWA 可離線）</footer>

  <script>
    const DATA_VOWELS = [{"j": "ㅏ", "ex": "아", "note": "a"}, {"j": "ㅐ", "ex": "애", "note": "ae"}, {"j": "ㅑ", "ex": "야", "note": "ya"}, {"j": "ㅒ", "ex": "얘", "note": "yae"}, {"j": "ㅓ", "ex": "어", "note": "eo"}, {"j": "ㅔ", "ex": "에", "note": "e"}, {"j": "ㅕ", "ex": "여", "note": "yeo"}, {"j": "ㅖ", "ex": "예", "note": "ye"}, {"j": "ㅗ", "ex": "오", "note": "o"}, {"j": "ㅘ", "ex": "와", "note": "wa"}, {"j": "ㅙ", "ex": "왜", "note": "wae"}, {"j": "ㅚ", "ex": "외", "note": "oe"}, {"j": "ㅛ", "ex": "요", "note": "yo"}, {"j": "ㅜ", "ex": "우", "note": "u"}, {"j": "ㅝ", "ex": "워", "note": "wo"}, {"j": "ㅞ", "ex": "웨", "note": "we"}, {"j": "ㅟ", "ex": "위", "note": "wi"}, {"j": "ㅠ", "ex": "유", "note": "yu"}, {"j": "ㅡ", "ex": "으", "note": "eu"}, {"j": "ㅢ", "ex": "의", "note": "ui"}, {"j": "ㅣ", "ex": "이", "note": "i"}];
    const DATA_CONSONANTS = [{"j": "ㄱ", "ex": "가", "note": "g/k"}, {"j": "ㄲ", "ex": "까", "note": "kk"}, {"j": "ㄴ", "ex": "나", "note": "n"}, {"j": "ㄷ", "ex": "다", "note": "d/t"}, {"j": "ㄸ", "ex": "따", "note": "tt"}, {"j": "ㄹ", "ex": "라", "note": "r/l"}, {"j": "ㅁ", "ex": "마", "note": "m"}, {"j": "ㅂ", "ex": "바", "note": "b/p"}, {"j": "ㅃ", "ex": "빠", "note": "pp"}, {"j": "ㅅ", "ex": "사", "note": "s"}, {"j": "ㅆ", "ex": "싸", "note": "ss"}, {"j": "ㅇ", "ex": "아", "note": "∅/ng"}, {"j": "ㅈ", "ex": "자", "note": "j"}, {"j": "ㅉ", "ex": "짜", "note": "jj"}, {"j": "ㅊ", "ex": "차", "note": "ch"}, {"j": "ㅋ", "ex": "카", "note": "k"}, {"j": "ㅌ", "ex": "타", "note": "t"}, {"j": "ㅍ", "ex": "파", "note": "p"}, {"j": "ㅎ", "ex": "하", "note": "h"}];
    const DATA_COUNTERS = [{"counter": "개", "note": "一般物品（個）", "system": "native"}, {"counter": "명", "note": "人（名）", "system": "native"}, {"counter": "마리", "note": "動物（隻）", "system": "native"}, {"counter": "잔", "note": "杯（飲料）", "system": "native"}, {"counter": "병", "note": "瓶", "system": "native"}, {"counter": "권", "note": "本（書）", "system": "native"}, {"counter": "장", "note": "張（票/紙）", "system": "native"}, {"counter": "대", "note": "台（車/機器）", "system": "native"}, {"counter": "시간", "note": "小時（持續）", "system": "native"}, {"counter": "살", "note": "歲", "system": "native"}, {"counter": "시", "note": "點（時）", "system": "native"}, {"counter": "번", "note": "次數", "system": "sino"}, {"counter": "층", "note": "樓層", "system": "sino"}, {"counter": "월", "note": "月份", "system": "sino"}, {"counter": "일", "note": "日期", "system": "sino"}, {"counter": "원", "note": "金額（韓元）", "system": "sino"}];
    const DATA_NATIVE = {"1": "하나", "2": "둘", "3": "셋", "4": "넷", "5": "다섯", "6": "여섯", "7": "일곱", "8": "여덟", "9": "아홉", "10": "열"};
    const DATA_SINO = {"1": "일", "2": "이", "3": "삼", "4": "사", "5": "오", "6": "육", "7": "칠", "8": "팔", "9": "구", "10": "십"};
    const DATA_CN2KO = {"你好": "안녕하세요", "謝謝": "감사합니다", "對不起": "죄송합니다", "請給我": "주세요", "多少錢": "얼마예요?", "可以幫我": "도와 주세요", "在哪裡": "어디예요?", "廁所": "화장실", "我要點餐": "주문할게요", "不要辣": "안 맵게 해 주세요", "我要結帳": "계산해 주세요", "有沒有": "있어요?", "可以嗎": "가능해요?", "不好意思": "실례합니다", "再見": "안녕히 가세요"};
    const DATA_DIALOGUES = [{"tag": "飾品買賣", "ko": ["이건 실버예요 아니면 도금이에요?", "이건 실버예요.", "이건 도금이에요.", "이건 스테인리스예요."], "zh": ["這是純銀還是電鍍？", "這是純銀。", "這是電鍍。", "這是不鏽鋼。"]}, {"tag": "飾品買賣", "ko": ["할인 되나요?", "네, 10% 할인돼요.", "세일 상품은 할인 안 돼요."], "zh": ["有折扣嗎？", "是的，可以打九折。", "特價商品不能再折扣。"]}, {"tag": "飾品買賣", "ko": ["보증서 있어요?", "네, 보증서 드려요.", "보증서는 이메일로 보내 드려요."], "zh": ["有保固書嗎？", "有，附上保固書。", "保固書會以電子郵件寄送。"]}, {"tag": "飾品買賣", "ko": ["각인 서비스 가능해요?", "네, 무료로 가능합니다.", "가능하지만 추가 요금이 있어요."], "zh": ["可以刻字嗎？", "可以，免費提供。", "可以，但需加價。"]}, {"tag": "飾品買賣", "ko": ["이건 실버예요 아니면 도금이에요?", "이건 실버예요.", "이건 도금이에요.", "이건 스테인리스예요."], "zh": ["這是純銀還是電鍍？", "這是純銀。", "這是電鍍。", "這是不鏽鋼。"]}, {"tag": "飾品買賣", "ko": ["할인 되나요?", "네, 10% 할인돼요.", "세일 상품은 할인 안 돼요."], "zh": ["有折扣嗎？", "是的，可以打九折。", "特價商品不能再折扣。"]}, {"tag": "飾品買賣", "ko": ["보증서 있어요?", "네, 보증서 드려요.", "보증서는 이메일로 보내 드려요."], "zh": ["有保固書嗎？", "有，附上保固書。", "保固書會以電子郵件寄送。"]}, {"tag": "飾品買賣", "ko": ["각인 서비스 가능해요?", "네, 무료로 가능합니다.", "가능하지만 추가 요금이 있어요."], "zh": ["可以刻字嗎？", "可以，免費提供。", "可以，但需加價。"]}, {"tag": "飾品買賣", "ko": ["이건 실버예요 아니면 도금이에요?", "이건 실버예요.", "이건 도금이에요.", "이건 스테인리스예요."], "zh": ["這是純銀還是電鍍？", "這是純銀。", "這是電鍍。", "這是不鏽鋼。"]}, {"tag": "飾品買賣", "ko": ["할인 되나요?", "네, 10% 할인돼요.", "세일 상품은 할인 안 돼요."], "zh": ["有折扣嗎？", "是的，可以打九折。", "特價商品不能再折扣。"]}, {"tag": "飾品買賣", "ko": ["보증서 있어요?", "네, 보증서 드려요.", "보증서는 이메일로 보내 드려요."], "zh": ["有保固書嗎？", "有，附上保固書。", "保固書會以電子郵件寄送。"]}, {"tag": "飾品買賣", "ko": ["각인 서비스 가능해요?", "네, 무료로 가능합니다.", "가능하지만 추가 요금이 있어요."], "zh": ["可以刻字嗎？", "可以，免費提供。", "可以，但需加價。"]}, {"tag": "飾品買賣", "ko": ["이건 실버예요 아니면 도금이에요?", "이건 실버예요.", "이건 도금이에요.", "이건 스테인리스예요."], "zh": ["這是純銀還是電鍍？", "這是純銀。", "這是電鍍。", "這是不鏽鋼。"]}, {"tag": "飾品買賣", "ko": ["할인 되나요?", "네, 10% 할인돼요.", "세일 상품은 할인 안 돼요."], "zh": ["有折扣嗎？", "是的，可以打九折。", "特價商品不能再折扣。"]}, {"tag": "飾品買賣", "ko": ["보증서 있어요?", "네, 보증서 드려요.", "보증서는 이메일로 보내 드려요."], "zh": ["有保固書嗎？", "有，附上保固書。", "保固書會以電子郵件寄送。"]}, {"tag": "飾品買賣", "ko": ["각인 서비스 가능해요?", "네, 무료로 가능합니다.", "가능하지만 추가 요금이 있어요."], "zh": ["可以刻字嗎？", "可以，免費提供。", "可以，但需加價。"]}, {"tag": "飾品買賣", "ko": ["이건 실버예요 아니면 도금이에요?", "이건 실버예요.", "이건 도금이에요.", "이건 스테인리스예요."], "zh": ["這是純銀還是電鍍？", "這是純銀。", "這是電鍍。", "這是不鏽鋼。"]}, {"tag": "飾品買賣", "ko": ["할인 되나요?", "네, 10% 할인돼요.", "세일 상품은 할인 안 돼요."], "zh": ["有折扣嗎？", "是的，可以打九折。", "特價商品不能再折扣。"]}, {"tag": "飾品買賣", "ko": ["보증서 있어요?", "네, 보증서 드려요.", "보증서는 이메일로 보내 드려요."], "zh": ["有保固書嗎？", "有，附上保固書。", "保固書會以電子郵件寄送。"]}, {"tag": "飾品買賣", "ko": ["각인 서비스 가능해요?", "네, 무료로 가능합니다.", "가능하지만 추가 요금이 있어요."], "zh": ["可以刻字嗎？", "可以，免費提供。", "可以，但需加價。"]}, {"tag": "購物", "ko": ["이 옷 입어 봐도 돼요?", "네, 피팅룸은 저쪽이에요.", "죄송하지만 세일 상품은 시착이 불가해요."], "zh": ["這件衣服可以試穿嗎？", "可以，試衣間在那邊。", "抱歉，特價商品不能試穿。"]}, {"tag": "購物", "ko": ["다른 색 있어요?", "네, 검정색도 있어요.", "지금은 흰색만 있어요."], "zh": ["有其他顏色嗎？", "有，還有黑色。", "現在只有白色。"]}, {"tag": "購物", "ko": ["교환/환불 가능해요?", "7일 이내 영수증 지참 시 가능합니다.", "포장 훼손 시 어렵습니다."], "zh": ["可以換/退嗎？", "七日內持收據可辦理。", "包裝損壞就不行。"]}, {"tag": "購物", "ko": ["이 옷 입어 봐도 돼요?", "네, 피팅룸은 저쪽이에요.", "죄송하지만 세일 상품은 시착이 불가해요."], "zh": ["這件衣服可以試穿嗎？", "可以，試衣間在那邊。", "抱歉，特價商品不能試穿。"]}, {"tag": "購物", "ko": ["다른 색 있어요?", "네, 검정색도 있어요.", "지금은 흰색만 있어요."], "zh": ["有其他顏色嗎？", "有，還有黑色。", "現在只有白色。"]}, {"tag": "購物", "ko": ["교환/환불 가능해요?", "7일 이내 영수증 지참 시 가능합니다.", "포장 훼손 시 어렵습니다."], "zh": ["可以換/退嗎？", "七日內持收據可辦理。", "包裝損壞就不行。"]}, {"tag": "購物", "ko": ["이 옷 입어 봐도 돼요?", "네, 피팅룸은 저쪽이에요.", "죄송하지만 세일 상품은 시착이 불가해요."], "zh": ["這件衣服可以試穿嗎？", "可以，試衣間在那邊。", "抱歉，特價商品不能試穿。"]}, {"tag": "購物", "ko": ["다른 색 있어요?", "네, 검정색도 있어요.", "지금은 흰색만 있어요."], "zh": ["有其他顏色嗎？", "有，還有黑色。", "現在只有白色。"]}, {"tag": "購物", "ko": ["교환/환불 가능해요?", "7일 이내 영수증 지참 시 가능합니다.", "포장 훼손 시 어렵습니다."], "zh": ["可以換/退嗎？", "七日內持收據可辦理。", "包裝損壞就不行。"]}, {"tag": "購物", "ko": ["이 옷 입어 봐도 돼요?", "네, 피팅룸은 저쪽이에요.", "죄송하지만 세일 상품은 시착이 불가해요."], "zh": ["這件衣服可以試穿嗎？", "可以，試衣間在那邊。", "抱歉，特價商品不能試穿。"]}, {"tag": "購物", "ko": ["다른 색 있어요?", "네, 검정색도 있어요.", "지금은 흰색만 있어요."], "zh": ["有其他顏色嗎？", "有，還有黑色。", "現在只有白色。"]}, {"tag": "購物", "ko": ["교환/환불 가능해요?", "7일 이내 영수증 지참 시 가능합니다.", "포장 훼손 시 어렵습니다."], "zh": ["可以換/退嗎？", "七日內持收據可辦理。", "包裝損壞就不行。"]}, {"tag": "購物", "ko": ["이 옷 입어 봐도 돼요?", "네, 피팅룸은 저쪽이에요.", "죄송하지만 세일 상품은 시착이 불가해요."], "zh": ["這件衣服可以試穿嗎？", "可以，試衣間在那邊。", "抱歉，特價商品不能試穿。"]}, {"tag": "購物", "ko": ["다른 색 있어요?", "네, 검정색도 있어요.", "지금은 흰색만 있어요."], "zh": ["有其他顏色嗎？", "有，還有黑色。", "現在只有白色。"]}, {"tag": "購物", "ko": ["교환/환불 가능해요?", "7일 이내 영수증 지참 시 가능합니다.", "포장 훼손 시 어렵습니다."], "zh": ["可以換/退嗎？", "七日內持收據可辦理。", "包裝損壞就不行。"]}, {"tag": "交通", "ko": ["공항까지 택시 얼마예요?", "보통 4만 원 정도예요.", "교통 상황에 따라 달라요."], "zh": ["到機場計程車多少錢？", "通常約四萬韓元。", "要看交通狀況。"]}, {"tag": "交通", "ko": ["이 버스 어디서 타요?", "저기 정류장에서 타시면 돼요.", "이 노선은 저녁 8시까지만 운행해요."], "zh": ["這班公車在哪裡搭？", "在那邊的站牌搭。", "這路線只到晚上八點。"]}, {"tag": "交通", "ko": ["환승은 어디서 해요?", "다음 역에서 내리시면 환승이에요.", "표지판 따라가시면 돼요."], "zh": ["在哪裡轉乘？", "下一站下車轉乘。", "跟著指示牌走就行。"]}, {"tag": "交通", "ko": ["공항까지 택시 얼마예요?", "보통 4만 원 정도예요.", "교통 상황에 따라 달라요."], "zh": ["到機場計程車多少錢？", "通常約四萬韓元。", "要看交通狀況。"]}, {"tag": "交通", "ko": ["이 버스 어디서 타요?", "저기 정류장에서 타시면 돼요.", "이 노선은 저녁 8시까지만 운행해요."], "zh": ["這班公車在哪裡搭？", "在那邊的站牌搭。", "這路線只到晚上八點。"]}, {"tag": "交通", "ko": ["환승은 어디서 해요?", "다음 역에서 내리시면 환승이에요.", "표지판 따라가시면 돼요."], "zh": ["在哪裡轉乘？", "下一站下車轉乘。", "跟著指示牌走就行。"]}, {"tag": "交通", "ko": ["공항까지 택시 얼마예요?", "보통 4만 원 정도예요.", "교통 상황에 따라 달라요."], "zh": ["到機場計程車多少錢？", "通常約四萬韓元。", "要看交通狀況。"]}, {"tag": "交通", "ko": ["이 버스 어디서 타요?", "저기 정류장에서 타시면 돼요.", "이 노선은 저녁 8시까지만 운행해요."], "zh": ["這班公車在哪裡搭？", "在那邊的站牌搭。", "這路線只到晚上八點。"]}, {"tag": "交通", "ko": ["환승은 어디서 해요?", "다음 역에서 내리시면 환승이에요.", "표지판 따라가시면 돼요."], "zh": ["在哪裡轉乘？", "下一站下車轉乘。", "跟著指示牌走就行。"]}, {"tag": "交通", "ko": ["공항까지 택시 얼마예요?", "보통 4만 원 정도예요.", "교통 상황에 따라 달라요."], "zh": ["到機場計程車多少錢？", "通常約四萬韓元。", "要看交通狀況。"]}, {"tag": "交通", "ko": ["이 버스 어디서 타요?", "저기 정류장에서 타시면 돼요.", "이 노선은 저녁 8시까지만 운행해요."], "zh": ["這班公車在哪裡搭？", "在那邊的站牌搭。", "這路線只到晚上八點。"]}, {"tag": "交通", "ko": ["환승은 어디서 해요?", "다음 역에서 내리시면 환승이에요.", "표지판 따라가시면 돼요."], "zh": ["在哪裡轉乘？", "下一站下車轉乘。", "跟著指示牌走就行。"]}, {"tag": "交通", "ko": ["공항까지 택시 얼마예요?", "보통 4만 원 정도예요.", "교통 상황에 따라 달라요."], "zh": ["到機場計程車多少錢？", "通常約四萬韓元。", "要看交通狀況。"]}, {"tag": "交通", "ko": ["이 버스 어디서 타요?", "저기 정류장에서 타시면 돼요.", "이 노선은 저녁 8시까지만 운행해요."], "zh": ["這班公車在哪裡搭？", "在那邊的站牌搭。", "這路線只到晚上八點。"]}, {"tag": "交通", "ko": ["환승은 어디서 해요?", "다음 역에서 내리시면 환승이에요.", "표지판 따라가시면 돼요."], "zh": ["在哪裡轉乘？", "下一站下車轉乘。", "跟著指示牌走就行。"]}, {"tag": "住宿", "ko": ["체크인 몇 시부터예요?", "오후 3시부터 체크인 가능해요.", "조기 체크인은 추가 요금이 있어요."], "zh": ["幾點可以入住？", "下午三點起可入住。", "提早入住需加價。"]}, {"tag": "住宿", "ko": ["레이트 체크아웃 가능해요?", "네, 오후 1시까지 가능해요.", "죄송하지만 오늘은 어렵습니다."], "zh": ["可以晚退房嗎？", "可以，最晚到下午一點。", "抱歉，今天不行。"]}, {"tag": "住宿", "ko": ["조식은 몇 시부터예요?", "7시부터 10시까지예요.", "레스토랑 1층에서 드실 수 있어요."], "zh": ["早餐幾點開始？", "七點到十點。", "在一樓餐廳用餐。"]}, {"tag": "住宿", "ko": ["체크인 몇 시부터예요?", "오후 3시부터 체크인 가능해요.", "조기 체크인은 추가 요금이 있어요."], "zh": ["幾點可以入住？", "下午三點起可入住。", "提早入住需加價。"]}, {"tag": "住宿", "ko": ["레이트 체크아웃 가능해요?", "네, 오후 1시까지 가능해요.", "죄송하지만 오늘은 어렵습니다."], "zh": ["可以晚退房嗎？", "可以，最晚到下午一點。", "抱歉，今天不行。"]}, {"tag": "住宿", "ko": ["조식은 몇 시부터예요?", "7시부터 10시까지예요.", "레스토랑 1층에서 드실 수 있어요."], "zh": ["早餐幾點開始？", "七點到十點。", "在一樓餐廳用餐。"]}, {"tag": "住宿", "ko": ["체크인 몇 시부터예요?", "오후 3시부터 체크인 가능해요.", "조기 체크인은 추가 요금이 있어요."], "zh": ["幾點可以入住？", "下午三點起可入住。", "提早入住需加價。"]}, {"tag": "住宿", "ko": ["레이트 체크아웃 가능해요?", "네, 오후 1시까지 가능해요.", "죄송하지만 오늘은 어렵습니다."], "zh": ["可以晚退房嗎？", "可以，最晚到下午一點。", "抱歉，今天不行。"]}, {"tag": "住宿", "ko": ["조식은 몇 시부터예요?", "7시부터 10시까지예요.", "레스토랑 1층에서 드실 수 있어요."], "zh": ["早餐幾點開始？", "七點到十點。", "在一樓餐廳用餐。"]}, {"tag": "住宿", "ko": ["체크인 몇 시부터예요?", "오후 3시부터 체크인 가능해요.", "조기 체크인은 추가 요금이 있어요."], "zh": ["幾點可以入住？", "下午三點起可入住。", "提早入住需加價。"]}, {"tag": "住宿", "ko": ["레이트 체크아웃 가능해요?", "네, 오후 1시까지 가능해요.", "죄송하지만 오늘은 어렵습니다."], "zh": ["可以晚退房嗎？", "可以，最晚到下午一點。", "抱歉，今天不行。"]}, {"tag": "住宿", "ko": ["조식은 몇 시부터예요?", "7시부터 10시까지예요.", "레스토랑 1층에서 드실 수 있어요."], "zh": ["早餐幾點開始？", "七點到十點。", "在一樓餐廳用餐。"]}, {"tag": "住宿", "ko": ["체크인 몇 시부터예요?", "오후 3시부터 체크인 가능해요.", "조기 체크인은 추가 요금이 있어요."], "zh": ["幾點可以入住？", "下午三點起可入住。", "提早入住需加價。"]}, {"tag": "住宿", "ko": ["레이트 체크아웃 가능해요?", "네, 오후 1시까지 가능해요.", "죄송하지만 오늘은 어렵습니다."], "zh": ["可以晚退房嗎？", "可以，最晚到下午一點。", "抱歉，今天不行。"]}, {"tag": "住宿", "ko": ["조식은 몇 시부터예요?", "7시부터 10시까지예요.", "레스토랑 1층에서 드실 수 있어요."], "zh": ["早餐幾點開始？", "七點到十點。", "在一樓餐廳用餐。"]}, {"tag": "餐廳", "ko": ["추천 메뉴가 뭐예요?", "오늘은 불고기를 추천합니다.", "비빔밥이 제일 인기가 많아요."], "zh": ["有推薦的菜嗎？", "今天推薦烤肉。", "拌飯最受歡迎。"]}, {"tag": "餐廳", "ko": ["덜 맵게 해 주세요.", "네, 고추는 빼 드릴게요.", "양념을 조금만 넣을게요."], "zh": ["請做不辣一點。", "好，我去掉辣椒。", "我只放一點調味。"]}, {"tag": "餐廳", "ko": ["포장 돼요?", "네, 포장 가능해요.", "조금 시간 걸려요."], "zh": ["可以外帶嗎？", "可以外帶。", "需要等一下。"]}, {"tag": "餐廳", "ko": ["추천 메뉴가 뭐예요?", "오늘은 불고기를 추천합니다.", "비빔밥이 제일 인기가 많아요."], "zh": ["有推薦的菜嗎？", "今天推薦烤肉。", "拌飯最受歡迎。"]}, {"tag": "餐廳", "ko": ["덜 맵게 해 주세요.", "네, 고추는 빼 드릴게요.", "양념을 조금만 넣을게요."], "zh": ["請做不辣一點。", "好，我去掉辣椒。", "我只放一點調味。"]}, {"tag": "餐廳", "ko": ["포장 돼요?", "네, 포장 가능해요.", "조금 시간 걸려요."], "zh": ["可以外帶嗎？", "可以外帶。", "需要等一下。"]}, {"tag": "餐廳", "ko": ["추천 메뉴가 뭐예요?", "오늘은 불고기를 추천합니다.", "비빔밥이 제일 인기가 많아요."], "zh": ["有推薦的菜嗎？", "今天推薦烤肉。", "拌飯最受歡迎。"]}, {"tag": "餐廳", "ko": ["덜 맵게 해 주세요.", "네, 고추는 빼 드릴게요.", "양념을 조금만 넣을게요."], "zh": ["請做不辣一點。", "好，我去掉辣椒。", "我只放一點調味。"]}, {"tag": "餐廳", "ko": ["포장 돼요?", "네, 포장 가능해요.", "조금 시간 걸려요."], "zh": ["可以外帶嗎？", "可以外帶。", "需要等一下。"]}, {"tag": "餐廳", "ko": ["추천 메뉴가 뭐예요?", "오늘은 불고기를 추천합니다.", "비빔밥이 제일 인기가 많아요."], "zh": ["有推薦的菜嗎？", "今天推薦烤肉。", "拌飯最受歡迎。"]}, {"tag": "餐廳", "ko": ["덜 맵게 해 주세요.", "네, 고추는 빼 드릴게요.", "양념을 조금만 넣을게요."], "zh": ["請做不辣一點。", "好，我去掉辣椒。", "我只放一點調味。"]}, {"tag": "餐廳", "ko": ["포장 돼요?", "네, 포장 가능해요.", "조금 시간 걸려요."], "zh": ["可以外帶嗎？", "可以外帶。", "需要等一下。"]}, {"tag": "餐廳", "ko": ["추천 메뉴가 뭐예요?", "오늘은 불고기를 추천합니다.", "비빔밥이 제일 인기가 많아요."], "zh": ["有推薦的菜嗎？", "今天推薦烤肉。", "拌飯最受歡迎。"]}, {"tag": "餐廳", "ko": ["덜 맵게 해 주세요.", "네, 고추는 빼 드릴게요.", "양념을 조금만 넣을게요."], "zh": ["請做不辣一點。", "好，我去掉辣椒。", "我只放一點調味。"]}, {"tag": "餐廳", "ko": ["포장 돼요?", "네, 포장 가능해요.", "조금 시간 걸려요."], "zh": ["可以外帶嗎？", "可以外帶。", "需要等一下。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["명동까지 어떻게 가요?", "2호선으로 갈아타세요."], "zh": ["到明洞怎麼去？", "請轉乘二號線。"]}, {"tag": "銀行", "ko": ["환전 어디서 해요?", "여기 창구에서 가능합니다."], "zh": ["在哪裡換匯？", "這邊櫃台可以。"]}, {"tag": "銀行", "ko": ["수수료가 얼마예요?", "1% 정도예요."], "zh": ["手續費多少？", "大約 1%。"]}, {"tag": "醫院", "ko": ["진료 예약하고 싶어요.", "접수처에서 예약 가능해요."], "zh": ["我想預約看診。", "在掛號櫃檯。"]}, {"tag": "醫院", "ko": ["약은 어디서 받아요?", "1층 약국에서 받아요."], "zh": ["在哪裡領藥？", "在一樓藥局。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}, {"tag": "問路", "ko": ["지하철역이 어디예요?", "저기 신호등 건너편에 있어요."], "zh": ["地鐵站在哪裡？", "在紅綠燈對面。"]}];

    // ====== Persistence / Voice ======
    let VOICES=[];
    const save=(k,v)=>localStorage.setItem(k, JSON.stringify(v));
    const load=(k,d)=>{ try{const v=localStorage.getItem(k); return v? JSON.parse(v): d;}catch(e){return d;} };
    const saveStr=(k,v)=>localStorage.setItem(k,v);
    const loadStr=(k,d)=>{ const v=localStorage.getItem(k); return v===null? d : v; };

    function speak(text){
      const msg=new SpeechSynthesisUtterance(text);
      msg.rate=parseFloat(loadStr('rate','1')); msg.pitch=parseFloat(loadStr('pitch','1'));
      const pickName=loadStr('voiceName',''); const voices=speechSynthesis.getVoices();
      let voice=voices.find(v=>v.name===pickName)||voices.find(v=>(v.lang||'').toLowerCase().startsWith('ko'))||voices[0];
      if(voice) msg.voice=voice; if(!(voice&&(voice.lang||'').toLowerCase().startsWith('ko'))&&/[가-힣]/.test(text)) msg.lang='ko-KR';
      speechSynthesis.cancel(); speechSynthesis.speak(msg);
    }

    function populateVoices(){
      VOICES = speechSynthesis.getVoices();
      const sel=document.getElementById('voiceSelect'); sel.innerHTML='';
      const sorted=VOICES.slice().sort((a,b)=>(a.lang||'').localeCompare(b.lang||''));
      sorted.forEach(v=>{ const o=document.createElement('option'); o.value=v.name; o.textContent=`${v.name} — ${v.lang}`; sel.appendChild(o); });
      const saved=loadStr('voiceName',''); if(saved && sorted.find(v=>v.name===saved)) sel.value=saved;
      else { const ko=sorted.find(v=>(v.lang||'').toLowerCase().startsWith('ko')); sel.value = ko? ko.name : (sorted[0]? sorted[0].name : ''); }
    }
    speechSynthesis.onvoiceschanged=populateVoices; populateVoices();
    document.getElementById('voiceSelect').addEventListener('change', e=> saveStr('voiceName', e.target.value));
    document.getElementById('rate').value = loadStr('rate','1'); document.getElementById('pitch').value = loadStr('pitch','1');
    document.getElementById('rate').addEventListener('input', e=> saveStr('rate', e.target.value));
    document.getElementById('pitch').addEventListener('input', e=> saveStr('pitch', e.target.value));
    document.getElementById('testBtn').addEventListener('click', ()=>speak('안녕하세요'));

    // 40音
    function renderJamo(list, el){ el.innerHTML=''; list.forEach(x=>{ const d=document.createElement('div'); d.className='card'; d.innerHTML=`<div class="k">${x.j}</div><div class="small">例：${x.ex||''}</div><div class="small">${x.note||''}</div>`; d.onclick=()=>speak(x.ex||x.j); el.appendChild(d); }); }
    renderJamo(DATA_VOWELS, document.getElementById('vowels')); renderJamo(DATA_CONSONANTS, document.getElementById('consonants'));

    // 數字＋量詞
    const counterSel=document.getElementById('qtyCounter');
    DATA_COUNTERS.forEach(c=>{ const o=document.createElement('option'); o.value=c.counter; o.textContent=`${c.counter} — ${c.note} (${c.system==='native'?'原生數詞':'漢字數詞'})`; o.dataset.system=c.system; counterSel.appendChild(o); });
    function buildQty(){ const n=Math.max(1,Math.min(10,parseInt(document.getElementById('qtyNum').value||'1'))); const sel=counterSel.options[counterSel.selectedIndex]; const sys=sel.dataset.system; const num=(sys==='native'? DATA_NATIVE[n] : DATA_SINO[n]); const phrase = `${num} ${sel.value}`; document.getElementById('qtyOut').textContent = `→ 韓文讀法：${phrase}`; speak(phrase); }
    document.getElementById('qtySpeak').addEventListener('click', buildQty);
    const numGrid=document.getElementById('numGrid');
    [1,2,3,4,5,6,7,8,9,10].forEach(n=>{ const d=document.createElement('div'); d.className='numcard'; d.innerHTML=`<div class="k">${DATA_NATIVE[n]}</div><div class="small">原生數詞 ${n}</div>`; d.onclick=()=>speak(DATA_NATIVE[n]); numGrid.appendChild(d); });
    [1,2,3,4,5,6,7,8,9,10].forEach(n=>{ const d=document.createElement('div'); d.className='numcard'; d.innerHTML=`<div class="k">${DATA_SINO[n]}</div><div class="small">漢字數詞 ${n}</div>`; d.onclick=()=>speak(DATA_SINO[n]); numGrid.appendChild(d); });

    // 對話：標籤＋搜尋＋收藏
    const favSet = new Set(load('favs', []));
    const tagBar=document.getElementById('tagBar'); const allTags=Array.from(new Set(DATA_DIALOGUES.map(d=>d.tag))).sort(); const activeTags=new Set();
    function renderTags(){ tagBar.innerHTML=''; allTags.forEach(t=>{ const chip=document.createElement('span'); chip.className='chip'; chip.textContent=t; if(activeTags.has(t)) chip.classList.add('active'); chip.onclick=()=>{ if(activeTags.has(t)) activeTags.delete(t); else activeTags.add(t); renderList(); renderTags(); }; tagBar.appendChild(chip); }); if(activeTags.size){ const clear=document.createElement('button'); clear.className='btn ghost'; clear.textContent='清除標籤'; clear.onclick=()=>{ activeTags.clear(); renderList(); renderTags(); }; tagBar.appendChild(clear); } }
    renderTags();
    const onlyFavBtn=document.getElementById('showFav'); let onlyFav=false; onlyFavBtn.onclick=()=>{ onlyFav=!onlyFav; onlyFavBtn.textContent = onlyFav? '顯示全部' : '只看收藏'; renderList(); };

    const listEl=document.getElementById('dialogueList');
    function toggleFav(key){ if (favSet.has(key)) favSet.delete(key); else favSet.add(key); save('favs', Array.from(favSet)); renderList(); }
    function renderList(){ const key=(document.getElementById('q').value||'').trim().toLowerCase(); listEl.innerHTML=''; let data=DATA_DIALOGUES.map((d,idx)=>Object.assign({idx}, d)); if (key) data=data.filter(d=> d.tag.toLowerCase().includes(key) || d.ko.join(' ').toLowerCase().includes(key) || d.zh.join(' ').toLowerCase().includes(key)); if (activeTags.size) data=data.filter(d=> activeTags.has(d.tag)); if (onlyFav) data=data.filter(d=> favSet.has(d.idx));
      data.forEach(d=>{ const wrap=document.createElement('div'); wrap.className='box'; const title=document.createElement('div'); title.innerHTML=`<b>${d.idx+1}. ${d.tag}</b>`; wrap.appendChild(title);
        d.ko.forEach((line,i)=>{ const row=document.createElement('div'); row.className='dialogue'; const left=document.createElement('div'); left.innerHTML=`<div class="ko">${i===0?'❓':''} ${line}</div><div class="zh">— ${d.zh[i] || ''}</div>`; const right=document.createElement('div'); right.className='right'; const speakBtn=document.createElement('button'); speakBtn.className='btn'; speakBtn.textContent='▶ 朗讀'; speakBtn.onclick=()=>speak(line); const fav=document.createElement('span'); fav.className='fav'; fav.textContent = favSet.has(d.idx)? '❤️' : '🤍'; fav.title='收藏/取消收藏'; fav.onclick=()=>toggleFav(d.idx); right.appendChild(speakBtn); right.appendChild(fav); row.appendChild(left); row.appendChild(right); wrap.appendChild(row); }); listEl.appendChild(wrap); }); }
    renderList(); document.getElementById('q').addEventListener('input', renderList);
    function resetFilter(){ document.getElementById('q').value=''; activeTags.clear(); onlyFav=false; document.getElementById('showFav').textContent='只看收藏'; renderList(); renderTags(); } window.resetFilter=resetFilter;

    // 自訂中文→韓文
    const cnInput=document.getElementById('cnInput'); const koInput=document.getElementById('koInput');
    document.getElementById('cnSuggest').onclick=()=>{ const txt=(cnInput.value||'').trim(); if(!txt) return; let out=txt; for(const k in DATA_CN2KO){ if(out.includes(k)) out = out.replaceAll(k, DATA_CN2KO[k]); } out = out.replaceAll('請','').replaceAll('幫我','').trim(); if(!/[가-힣]/.test(out)) out='한국어로 수정해 주세요'; koInput.value=out; };
    document.getElementById('koSpeak').onclick=()=>{ const t=(koInput.value||'').trim(); if(t) speak(t); };
    const myListEl=document.getElementById('myList');
    function renderMy(){ const mine=load('myDialogues',[]); myListEl.innerHTML='<h3>我的對話</h3>'; if(!mine.length) myListEl.innerHTML+='<div class="small">尚無自訂對話</div>'; mine.forEach((d,idx)=>{ const row=document.createElement('div'); row.className='dialogue'; const left=document.createElement('div'); left.innerHTML=`<div class="ko">🗣️ ${d.ko}</div><div class="zh">— ${d.cn}</div>`; const right=document.createElement('div'); right.className='right'; const btn=document.createElement('button'); btn.className='btn'; btn.textContent='▶ 朗讀'; btn.onclick=()=>speak(d.ko); const del=document.createElement('button'); del.className='btn outline'; del.textContent='刪除'; del.onclick=()=>{ const arr=load('myDialogues',[]); arr.splice(idx,1); save('myDialogues',arr); renderMy(); }; right.appendChild(btn); right.appendChild(del); row.appendChild(left); row.appendChild(right); myListEl.appendChild(row); }); }
    renderMy();
    document.getElementById('saveCustom').onclick=()=>{ const cn=(cnInput.value||'').trim(); const ko=(koInput.value||'').trim(); if(!cn||!ko) return; const arr=load('myDialogues',[]); arr.unshift({cn,ko}); save('myDialogues',arr); cnInput.value=''; koInput.value=''; renderMy(); };

    // 測驗遊戲
    let quizData=[]; let score=0; let total=0;
    function startQuiz(){ const pool=[]; DATA_DIALOGUES.forEach(d=> d.ko.forEach((k,i)=> pool.push({ko:k, zh:d.zh[i]||''}))); quizData = pool.sort(()=>Math.random()-0.5).slice(0,20); score=0; total=0; renderQuiz(); }
    function renderQuiz(){ const area=document.getElementById('quizArea'); const scoreBox=document.getElementById('quizScore'); if (total>=quizData.length){ area.innerHTML='<b>完成！</b>'; scoreBox.textContent=`得分：${score} / ${quizData.length}`; return; } const q=quizData[total]; const allZH=DATA_DIALOGUES.flatMap(d=>d.zh).filter(Boolean); const opts=new Set([q.zh]); while(opts.size<4) opts.add(allZH[Math.floor(Math.random()*allZH.length)]); const choices=Array.from(opts).sort(()=>Math.random()-0.5);
      area.innerHTML=''; const box=document.createElement('div'); box.className='box'; box.innerHTML=`<div class="ko">🗣️ ${q.ko}</div><div class="small">請選出正確中文意思</div>`; const row=document.createElement('div'); row.className='row'; choices.forEach(c=>{ const b=document.createElement('button'); b.className='btn ghost'; b.textContent=c; b.onclick=()=>{ if(c===q.zh) score++; total++; renderQuiz(); }; row.appendChild(b); }); const speakBtn=document.createElement('button'); speakBtn.className='btn'; speakBtn.textContent='▶ 朗讀韓文'; speakBtn.onclick=()=>speak(q.ko); box.appendChild(document.createElement('br')); box.appendChild(speakBtn); area.appendChild(box); area.appendChild(row); scoreBox.textContent=`目前得分：${score} / ${total}`; }
    document.getElementById('startQuiz').onclick=startQuiz;

    // PWA
    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./service-worker.js');
  </script>
</body>
</html>
